trigger:
- none

pool:
  vmImage: ubuntu-latest

variables:
  projectPath: src/Catalog.API
  caName: catalog-test
  rg: testapp-rg
  acaEnv: testappenv12
  registry: eshoptestacr1

steps:
  - task: UseDotNet@2
    inputs:
      packageType: 'sdk'
      useGlobalJson: true
  - script: |
      dotnet workload update
      dotnet workload restore
      dotnet restore $(projectPath)
      dotnet build -c Release $(projectPath)
      dotnet publish -c Release -o $(Build.ArtifactStagingDirectory) $(projectPath)
  - task: AzureCLI@2
    inputs:
      azureSubscription: 'Azure Learning Sub(d7e3c15f-a785-4ecd-944b-d03698d68b5d)'
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        az containerapp up \
        -n $(caName) -g $(rg) \
        --environment $(acaEnv) \
        --source $(Build.ArtifactStagingDirectory) \
        --registry-server '$(registry).azurecr.io'